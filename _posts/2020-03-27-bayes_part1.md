---
keywords: fastai
description: ベイズ推論の一連の流れを整理する。
title: ベイズ勉強会 Part 1 ベイズ推論のワークフロー
toc: true 
badges: false
comments: true
categories: [bayes]
image: images/dag1.png
nb_path: _notebooks/2020-03-27-bayes_part1.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-03-27-bayes_part1.ipynb
-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>参考図書 {% fn 1 %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="&#27010;&#35542;:-&#12505;&#12452;&#12474;&#25512;&#35542;&#12398;&#12527;&#12540;&#12463;&#12501;&#12525;&#12540;">&#27010;&#35542;: &#12505;&#12452;&#12474;&#25512;&#35542;&#12398;&#12527;&#12540;&#12463;&#12501;&#12525;&#12540;<a class="anchor-link" href="#&#27010;&#35542;:-&#12505;&#12452;&#12474;&#25512;&#35542;&#12398;&#12527;&#12540;&#12463;&#12501;&#12525;&#12540;"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include important.html content='ベイズ推論の共通するワークフロー' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><ol>
<li>観測データ$\mathcal{D}$と観測されていない未知の変数$\mathbf{X}$の同時分布$p(\mathcal{D}, \mathbf{X})$を構築</li>
<li>事後分布$p(\mathbf{X}|\mathcal{D}) = \frac{p(\mathcal{D}, \mathbf{X})}{p(\mathcal{D})}$を求める。</li>
</ol>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>今回はさらに事後分布を用いて予測分布を計算するところまでを見る。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#20104;&#28204;&#20998;&#24067;">&#20104;&#28204;&#20998;&#24067;<a class="anchor-link" href="#&#20104;&#28204;&#20998;&#24067;"> </a></h2><p>観測されたデータ$\mathcal{D}$に対して、パラメタ$\theta$を持つ確率分布でモデルを組み、新しいデータ$x_*$を予測したい。$\mathcal{D}$と$x_*$が独立に生成されるとすると、以下のような予測分布を用いることができる。</p>
<p>{{% raw %}}
$$p(x_*|\mathcal{D}) = \int p(x_*|\theta)p(\theta|\mathcal{D}) d\theta$$
{{% endraw %}}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>$\mathcal{D}$, $\theta$, $x_*$の関係をDAGで表すと次のようになる。</p>
<p><img src="/deoxydata-science/images/copied_from_nb/dags/dag1.png" alt=""></p>
<p>この時、$\mathcal{D}$と$x_*$はパラメタ$\theta$が与えられた条件の下での条件付き独立である。</p>
<h3 id="&#21516;&#26178;&#20998;&#24067;&#12398;&#35352;&#36848;">&#21516;&#26178;&#20998;&#24067;&#12398;&#35352;&#36848;<a class="anchor-link" href="#&#21516;&#26178;&#20998;&#24067;&#12398;&#35352;&#36848;"> </a></h3><p>$\mathcal{D}$と$x_*$がパラメタ$\theta$が与えられた条件の下での条件付き独立であることから同時分布は以下のようになる。
$$
p(\mathcal{D}, x_*, \theta) = p(\mathcal{D}|\theta)p(x_*|\theta)p(\theta)
$$</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='$p(\theta)$は2個必要なのではないかと思うかもしれない。サイコロの目によって動きが決まる駒が2つあり、同時に動かす状況を考えよう。コマの動きを決めるのにサイコロを振る回数は1回である。' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='$p(\mathcal{D}|\theta)$の部分はパラメタからデータが生成される過程を記述している。これを$\theta$の関数として見た場合尤度関数と呼ぶ。この尤度関数を最大化する$\theta$を$\theta$の予測値とする方法を最尤推定という。' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='$p(\theta)$を事前分布という。同時確率は尤度関数×事前分布の形で書くことができる。' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="&#20107;&#24460;&#20998;&#24067;&#12398;&#25512;&#35542;">&#20107;&#24460;&#20998;&#24067;&#12398;&#25512;&#35542;<a class="anchor-link" href="#&#20107;&#24460;&#20998;&#24067;&#12398;&#25512;&#35542;"> </a></h3><p>データ$\mathcal{D}$だけが手元にある時、残りの変数の事後分布は
$$
\begin{eqnarray}
    p(x_*, \theta|\mathcal{D}) &amp;=&amp; \frac{p(\mathcal{D}, x_*, \theta)}{p(\mathcal{D})} \\
    &amp;=&amp; \frac{p(\mathcal{D}|\theta)p(x_*|\theta)p(\theta)}{p(\mathcal{D})} \\
    &amp;=&amp; p(x_*|\theta)p(\theta|\mathcal{D})
\end{eqnarray}
$$
となる。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='ベイズの定理から$p(\theta|\mathcal{D}) = \frac{p(\mathcal{D}|\theta)p(\theta)}{p(\mathcal{D})}$となることを用いた。' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='$p(\theta|\mathcal{D})$を最大化する$\theta$を$\theta$の予測値とする方法を事後確率最大化推定(MAP推定)と呼ぶ。' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="&#20104;&#28204;&#20998;&#24067;&#12398;&#31639;&#20986;">&#20104;&#28204;&#20998;&#24067;&#12398;&#31639;&#20986;<a class="anchor-link" href="#&#20104;&#28204;&#20998;&#24067;&#12398;&#31639;&#20986;"> </a></h3><p>$\mathcal{D}$が決まった時の$x_*$の確率分布、すなわち予測分布$p(x_*|\mathcal{D})$は$\theta$を積分除去することで得られる。</p>
<p>{{% raw %}}
$$p(x_*|\mathcal{D}) = \int p(x_*|\theta)p(\theta|\mathcal{D}) d\theta$$
{{% endraw %}}</p>
<p>以上がベイズ推論の予測までを含めた一連の流れである。次回から離散確率分布について具体的にやってみる。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{{ '<a href="https://www.kspub.co.jp/book/detail/1538320.html">『ベイズ推論による機械学習入門』(須山敦志、講談社)</a>' | fndetail: 1 }}</p>

</div>
</div>
</div>
</div>
 

